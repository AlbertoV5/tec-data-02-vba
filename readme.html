<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-07-14 Thu 14:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Visual Basic for Applications</title>
<meta name="author" content="Alberto Valdez" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://albertov5.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://albertov5.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://albertov5.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://albertov5.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Visual Basic for Applications</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8c13c47">Introduction</a></li>
<li><a href="#orgff34453">Reference</a>
<ul>
<li><a href="#org0dd1a6a">Subroutine Declaration</a></li>
<li><a href="#org99220e6">Variable Declaration</a></li>
<li><a href="#orga698558">Data Types</a></li>
<li><a href="#orga40ebc9">Object Types</a></li>
<li><a href="#org2f650ba">Arrays</a></li>
<li><a href="#org0438c70">Strings</a></li>
</ul>
</li>
<li><a href="#org1311e8a">Keywords and Operators</a>
<ul>
<li><a href="#orgadce8bd">Conditional</a></li>
<li><a href="#orgd90a8e6">Loops</a></li>
<li><a href="#orgc7d5313">Visual Style Formatting</a></li>
</ul>
</li>
<li><a href="#orgc8a9e1d">Design Patterns</a></li>
<li><a href="#org48c7696">Research</a></li>
<li><a href="#org0b1b164">Developing a Macro</a></li>
<li><a href="#org5fe1040">Debugging Code</a></li>
<li><a href="#orga077708">Running Macros with Buttons</a></li>
</ul>
</div>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="https://albertov5.github.io/tec-data/index.html">&lt;&lt;&lt;Home</a></td>
<td class="org-left"><a href="./lesson-1.html">Lesson-1</a></td>
<td class="org-left"><a href="./lesson-2.html">Lesson-2</a></td>
<td class="org-left"><a href="./challenge/readme.html">Challenge&gt;&gt;&gt;</a></td>
</tr>
</tbody>
</table>

<div id="outline-container-org8c13c47" class="outline-2">
<h2 id="org8c13c47">Introduction</h2>
<div class="outline-text-2" id="text-org8c13c47">
<p>
Excel uses a scripting language to create its macros, it lives inside VBA and the execution is reserved to Office software. The code can be written in any other editor but Excel has a Development Environment that supports running the scripts directly inside it and they afftect the current work sheet.
</p>

<p>
Macros are Subroutines (<code>Sub</code>) that can be called by name from the spreadsheet after enabling macros. This is an example of a macro that will print out the values in Cells (1, 1) to (1, 8).
</p>

<div class="org-src-container">
<pre class="src src-vba">Sub DQAnalysis()
    Worksheets("DQ Analysis").Activate

    Range("A1").Value = "DAQO (Ticker: DQ)"

    'Create a header row
    Cells(3, 1).Value = "Year"
    Cells(3, 2).Value = "Total Daily Volume"
    Cells(3, 3).Value = "Return"

    Worksheets("2018").Activate
    For i = 1 To 8
        MsgBox (Cells(1, i))

    Next i

End Sub
</pre>
</div>

<p>
We can access cells with the <code>Cells</code> keyword or using <code>Range</code>. We can always reference the existing methods and properties in Microsoft&rsquo;s website <sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>.
</p>
</div>
</div>

<div id="outline-container-orgff34453" class="outline-2">
<h2 id="orgff34453">Reference</h2>
<div class="outline-text-2" id="text-orgff34453">
</div>
<div id="outline-container-org0dd1a6a" class="outline-3">
<h3 id="org0dd1a6a">Subroutine Declaration</h3>
<div class="outline-text-3" id="text-org0dd1a6a">
<div class="org-src-container">
<pre class="src src-vba">Sub MySubroutine()
    'code goes here
End Sub
</pre>
</div>
</div>
</div>

<div id="outline-container-org99220e6" class="outline-3">
<h3 id="org99220e6">Variable Declaration</h3>
<div class="outline-text-3" id="text-org99220e6">
<div class="org-src-container">
<pre class="src src-vba">Dim my_number As Integer
</pre>
</div>
</div>
</div>

<div id="outline-container-orga698558" class="outline-3">
<h3 id="orga698558">Data Types</h3>
<div class="outline-text-3" id="text-orga698558">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Size in Memory</th>
<th scope="col" class="org-left">Range of Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Byte</td>
<td class="org-left">1 Byte</td>
<td class="org-left">0 to 255</td>
</tr>

<tr>
<td class="org-left">Integer</td>
<td class="org-left">2 Bytes</td>
<td class="org-left">-32,768 to 32767</td>
</tr>

<tr>
<td class="org-left">Single</td>
<td class="org-left">4 Bytes</td>
<td class="org-left">-3.4E38 to 3.4E38</td>
</tr>

<tr>
<td class="org-left">Long</td>
<td class="org-left">8 Bytes</td>
<td class="org-left">-2,147,483,648 to 2,147,483,648</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">8 Bytes</td>
<td class="org-left">January 1, 100 to December 31, 999</td>
</tr>

<tr>
<td class="org-left">Currency</td>
<td class="org-left">8 Bytes</td>
<td class="org-left">-922,337,203,685,477.5808 to 922,337,203,685,477.5807</td>
</tr>

<tr>
<td class="org-left">String (dynamic)</td>
<td class="org-left">10 Bytes</td>
<td class="org-left">0 to 2 billion characters</td>
</tr>

<tr>
<td class="org-left">String (fixed)</td>
<td class="org-left">string length</td>
<td class="org-left">1 to approximately 65,400</td>
</tr>

<tr>
<td class="org-left">Boolean</td>
<td class="org-left">4 Bytes</td>
<td class="org-left">True or False</td>
</tr>

<tr>
<td class="org-left">Object</td>
<td class="org-left">4 Bytes</td>
<td class="org-left">Object in VBA</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orga40ebc9" class="outline-3">
<h3 id="orga40ebc9">Object Types</h3>
<div class="outline-text-3" id="text-orga40ebc9">
<p>
The <code>object</code> type can point to data of any type, can be used as generic type for whenever you don&rsquo;t know the type of the variable it may point to.
</p>

<div class="org-src-container">
<pre class="src src-vba">Dim my_object As Object
</pre>
</div>

<p>
<code>Object</code> does not contain the data value itself, as it&rsquo;s a pointer to that value. <sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup> So it always uses the same space in memory. It&rsquo;s recommended to always define a variable by a specific type rather than trying to point to it at runtime.
</p>
</div>
</div>

<div id="outline-container-org2f650ba" class="outline-3">
<h3 id="org2f650ba">Arrays</h3>
<div class="outline-text-3" id="text-org2f650ba">
<p>
Arrays hold an arbitrary number of variables of the same type. Instead of creating many variables that share a type, we can create an array.
</p>

<p>
We index arrays with an integer <code>i</code>. Arrays in VBA are zero-based.
</p>

<p>
Declaring arrays.
</p>
<div class="org-src-container">
<pre class="src src-vba">Dim tickers(11) As String
</pre>
</div>

<p>
Accessing arrays.
</p>
<div class="org-src-container">
<pre class="src src-vba">tickers(0) = "AY"
tickers(1) = "CSIQ"
tickers(2) = "DQ"
</pre>
</div>
</div>
</div>

<div id="outline-container-org0438c70" class="outline-3">
<h3 id="org0438c70">Strings</h3>
<div class="outline-text-3" id="text-org0438c70">
<p>
Concatenating strings.
</p>
<div class="org-src-container">
<pre class="src src-vba">Range("A1").Value = "All Stocks (" + yearValue + ")"
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1311e8a" class="outline-2">
<h2 id="org1311e8a">Keywords and Operators</h2>
<div class="outline-text-2" id="text-org1311e8a">
<p>
Here is some syntax reference for the common keywords in VBA:
</p>
</div>

<div id="outline-container-orgadce8bd" class="outline-3">
<h3 id="orgadce8bd">Conditional</h3>
<div class="outline-text-3" id="text-orgadce8bd">
<p>
If, Then.
</p>
<div class="org-src-container">
<pre class="src src-vba">If 3 &gt; 2 Then
    ' Code here
End If
</pre>
</div>

<p>
Equal operator.
</p>
<div class="org-src-container">
<pre class="src src-vba">Cells(i, 1).Value = "DQ"
</pre>
</div>

<p>
Not equal operator.
</p>
<div class="org-src-container">
<pre class="src src-vba">Cells(i - 1, 1).Value &lt;&gt; "DQ"
</pre>
</div>

<p>
And keyword.
</p>
<div class="org-src-container">
<pre class="src src-vba">If Cells(i, 1).Value = "DQ" And Cells(i - 1, 1).Value &lt;&gt; "DQ" Then
    'set starting price
End If
</pre>
</div>

<p>
ElseIf.
</p>
<div class="org-src-container">
<pre class="src src-vba">If Cells(4, 3) &gt; 0 Then
    'Color the cell green
    Cells(4, 3).Interior.Color = vbGreen
ElseIf Cells(4, 3) &lt; 0 Then
    'Color the cell red
    Cells(4, 3).Interior.Color = vbRed
Else
    'Clear the cell color
    Cells(4, 3).Interior.Color = xlNone
End If
</pre>
</div>
</div>
</div>


<div id="outline-container-orgd90a8e6" class="outline-3">
<h3 id="orgd90a8e6">Loops</h3>
<div class="outline-text-3" id="text-orgd90a8e6">
<p>
For loop.
</p>
<div class="org-src-container">
<pre class="src src-vba">For i = 1 To 10
    ' Code here
Next i
</pre>
</div>

<p>
Nested loops.
</p>
<div class="org-src-container">
<pre class="src src-vba">For i = 1 To 10
    ' code here
    For j = 1 to 20
        ' code here
    Next j
Next i
</pre>
</div>

<p>
Accessing arrays in loops.
</p>
<div class="org-src-container">
<pre class="src src-vba">For i = 0 To 11
    ticker = tickers(i)
    ' Do stuff with ticker
Next i
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7d5313" class="outline-3">
<h3 id="orgc7d5313">Visual Style Formatting</h3>
<div class="outline-text-3" id="text-orgc7d5313">
<p>
Styling.
</p>
<div class="org-src-container">
<pre class="src src-vba">Range("A3:C3").Font.Bold = True
Columns("B").AutoFit
</pre>
</div>

<p>
Number Formatting.
</p>
<div class="org-src-container">
<pre class="src src-vba">Range("B4:B15").NumberFormat = "#,##0"
Range("C4:C15").NumberFormat = "0.0%"
</pre>
</div>

<p>
Digits of Precision.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Format</th>
<th scope="col" class="org-left">Precision</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&ldquo;0.0%&rdquo;</td>
<td class="org-left">one digit</td>
</tr>

<tr>
<td class="org-left">&ldquo;0.00%&rdquo;</td>
<td class="org-left">two digits</td>
</tr>
</tbody>
</table>

<p>
Colors.
</p>
<div class="org-src-container">
<pre class="src src-vba">Cells(4, 3).Interior.Color = vbGreen
Cells(4, 3).Interior.Color = vbRed
Cells(4, 3).Interior.Color = xlNone
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc8a9e1d" class="outline-2">
<h2 id="orgc8a9e1d">Design Patterns</h2>
<div class="outline-text-2" id="text-orgc8a9e1d">
<p>
Patterns can be expressed as pseudocode, which means that we are only describing what the process looks like once we generalize it.
</p>

<p>
A good way to find them is to create a few cases by hand first and see if a pattern arises once we see them side by side. For example:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Cases</th>
<th scope="col" class="org-right">input</th>
<th scope="col" class="org-right">output</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Case 1</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">Case 2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">Case 3</td>
<td class="org-right">3</td>
<td class="org-right">1.25</td>
</tr>

<tr>
<td class="org-left">Case 4</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>

<p>
We can then assume that our output will be <code>output = 4/input</code>. So the pattern will be:
</p>

<div class="org-src-container">
<pre class="src src-vba">Sub DivBy4()
    For i = 1 To 10
        Cells(i, 2).Value = 4 / Cells(i, 1).Value
    Next i
End Sub
</pre>
</div>

<p>
The code will give us the result of any input we give it. So the value of cell 2 will be equal to 4 divided by the value of cell 1. This way we can operate in any number of cases. It&rsquo;s good to always test for outlier cases as our design needs to cover them too. For example, <code>we have to check that the input is not zero</code>.
</p>

<p>
Once our design is solid, we can reuse the code in other applications as long as it fits them. The more cases it can cover, the better.
</p>
</div>
</div>


<div id="outline-container-org48c7696" class="outline-2">
<h2 id="org48c7696">Research</h2>
<div class="outline-text-2" id="text-org48c7696">
<p>
Another way to iterate over our design patterns is to look for answers that other people have come up with or simply look at the documentation for a better understanding of the features and rules of the programming language.
</p>

<p>
For example, we wouldn&rsquo;t be able to know what <code>xlUp</code> does without looking at the documentation or getting that information from a quick google search.
</p>
<div class="org-src-container">
<pre class="src src-vba">rowEnd = Cells(Rows.Count, "A").End(xlUp).Row
</pre>
</div>
</div>
</div>


<div id="outline-container-org0b1b164" class="outline-2">
<h2 id="org0b1b164">Developing a Macro</h2>
<div class="outline-text-2" id="text-org0b1b164">
<p>
In order to create a proper algorithm/design, we will map out a plan of what we need to execute. Let&rsquo;s write down the an example of a general objective and then go step by step:
</p>

<ol class="org-ol">
<li>Format our working sheet with headers.</li>
<li>Initialize an array of existing items.</li>
<li>Initialize variables based on our data.</li>
<li>Initialize output variables with no value yet.</li>
<li>Loop through our data.</li>
<li>Write down the results</li>
</ol>

<p>
We have to translate that pseudocode into actual code, so now we go step by step. For the sake of simplicity, we will only visit the first step:
</p>

<ol class="org-ol">
<li>Format our working sheet with headers:</li>
</ol>
<div class="org-src-container">
<pre class="src src-vba">Worksheets("All Stocks Analysis").Activate
Range("A1").Value = "All Stocks (2018)"

Cells(3, 1).Value = "Ticker"
Cells(3, 2).Value = "Total Daily Volume"
Cells(3, 3).Value = "Return"
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fe1040" class="outline-2">
<h2 id="org5fe1040">Debugging Code</h2>
<div class="outline-text-2" id="text-org5fe1040">
<p>
It&rsquo;s a good idea to execute the macro everytime we complete a step and even make a commit to our repository to keep track of our progress and versions of our code.
</p>

<p>
Luckily, Excel can help us find problems in our code with its debugging tools. It&rsquo;s also not a bad idea to <code>google</code> the error messages to see possible solutions in case we don&rsquo;t see it right away.
</p>
</div>
</div>

<div id="outline-container-orga077708" class="outline-2">
<h2 id="orga077708">Running Macros with Buttons</h2>
<div class="outline-text-2" id="text-orga077708">
<p>
Go to <code>Developer=&gt;Button=&gt;Select Area in worksheet=&gt;Select your Macro</code>.
Then you can edit your button name, look and feel, and then test it by clicking it.
</p>

<p>
Using user input.
</p>
<div class="org-src-container">
<pre class="src src-vba">yearValue = InputBox("What year would you like to run the analysis on?")
</pre>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://docs.microsoft.com/en-us/office/vba/api/overview/excel/graph-visual-basic-reference">https://docs.microsoft.com/en-us/office/vba/api/overview/excel/graph-visual-basic-reference</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://en.wikipediarg/wiki/Pointer_(computer_programming)">https://en.wikipediarg/wiki/Pointer_(computer_programming)</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Alberto Valdez</p>
<p class="date">Created: 2022-07-14 Thu 14:39</p>
</div>
</body>
</html>
